#实验报告——数据库的完整性和安全性
----

##一、实验目的

##二、实验平台

###1.数据库管理系统    
**MySQL 5.7.20**

###2.可视化管理工具

###3.操作系统
**Windows 10（企业版）**

##三、实验准备
**创建用户:**     

![](images\start.png)    

**中文编码问题：**   

![](images\utf8.png)    

##四、实验内容

###4.数据库安全性

###4.2数据库安全性控制

###授权：授予与收回    

首先建立u1-u7的用户      

![](images\4.1.1.png)   

![](images\4.1.2.png)    

错误原因：3115005124没有GRANT权限，解决方法：使用root用户赋予3115005124@localhost用户GRANT权限。    

![](images\4.1.3.png)   

查询用户列表。  

![](images\4.1.4.png)     
     
-----

【4.1】把查询Student表的权限授给用户U1。    

![](images\4.1.5.png)    

错误原因：不能在用户表中找到u1这个用户。在Mysql中用户名必须为创建时的全名，解决方法如下：    

![](images\4.1.6.png)   

【4.2】把对Student表和Course表的全部操作权限授予用户U2和U3。    

![](images\4.2.1.png)    

错误原因：Mysql不支持同时将两张表的权限授予用户，解决方法如下：    

![](images\4.2.2.png)    

【4.3】把对表SC的查询权限授予所有用户。    

![](images\4.3.1.png)    

错误原因：public 不是用户表里面的用户，也就是说Mysql没有用户组的概念，不能用public来代替所有的用户，解决方法暂为一个个授权。   

【4.4】把查询Student表和修改学生学号的权限授给用户U4。     

![](images\4.4.1.png)    


【4.5】把对表SC的INSERT权限授予U5用户，并允许将此权限再授予其他用户。    

![](images\4.5.1.png)    

【4.6】

	GRANT INSERT
	ON TABLE SC 
	TO U6
	WITH GRANT OPTION;   

![](images\4.6.1.png)    
 
【4.7】

	GRANT INSERT 
	ON TABLE SC 
	TO U7;    

![](images\4.7.1.png)   

----

【4.8】把用户U4修改学生学号的权限收回。    

![](images\4.8.1.png)   

【4.9】收回所有用户对表SC的查询权限。    

![](images\4.9.1.png)   

【4.10】把用户U5对SC表的INSERT权限收回。    

![](images\4.10.1.png)   

错误原因：mysql不支持CASCADE，所以这里报错。    

----
###数据库角色

【4.11】通过角色来实现将一组权限授予一个用户。    

![](images\4.11.1.png)   

错误原因：Mysql不支持角色的创建，所以这里与角色有关的操作都无法进行。    

【4.12】角色的权限修改。    
	
	GRANT DELETE
	ON TABLE Student
	TO R1;

【4.13】

	REVOKE SELECT
	ON TABLE Student
	FROM R1；


###4.3视图机制

【4.14】建立计算机系学生的视图，把对该视图的SELECT权限授予王平，把该视图上单所有操作权限授予张明。     

![](images\4.14.1.png)   

建立计算机系学生的视图，把该视图的select权限授予u7，再将权限授予u6。    

###4.4审计

【4.15】对修改SC表结构或修改SC表数据的操作进行审计。    

![](images\4.15.1.png)   

错误原因：mysql服务器自身没有提供审计功能。

【4.16】取消对SC表的一切审计。    

	NOAUDIT ALTER,UPDATE
	ON SC;

-----

###数据库完整性


###5.1实体完整性

###定义实体完整性

**由于本章实验设计大量删表建表操作，为了不对之前student——course数据库造成不可恢复的修改，此章定义新的数据库test5。**     

【5.1】将Student表中的Sno属性定义为码。     

![](images\5.1.1.png)   

【5.2】将SC表中的Sno、Cno属性组定义为码。     

![](images\5.2.1.png)   

###5.2参照完整性

###定义参照完整性

【5.3】定义SC表中的参照完整性。    

![](images\5.3.1.png)   

错误原因：test5数据库中没有Course表。解决方法如下：先新建Course表，再完成有关操作。     

![](images\5.3.2.png)   
![](images\5.3.3.png)   

###参照完整性检查和违约处理

【5.4】显式说明参照完整性的违约处理示例。   

![](images\5.4.1.png)   
![](images\5.4.2.png)   

###5.3用户定义的完整性

###属性上的约束条件

【5.5】在定义SC表时，说明Sno、Cno、Grade属性不允许取空值。    

![](images\5.5.1.png)   

【5.6】建立部门表DEPT，要求部门名称Dname列取值唯一，部门编号Deptno列为主码。     

![](images\5.6.1.png)   

【5.7】Student表的Ssex只允许取“男”或“女”。    

![](images\5.7.1.png)   

【5.8】SC表的Grade的值应该在0和100之间。    

![](images\5.8.1.png)   


###元组上约束条件的定义

【5.9】当学生的性别是男时，其名字不能以Mr.s打头。    

![](images\5.9.1.png)    

错误原因：在之前建立SC表的时候，SC表的外键Sno与student表的主键约束，所以此时无法删除student表，此时可以先删除SC表，再删除student表。       

![](images\5.9.2.png)   

重新建立SC表：    

![](images\5.9.3.png)   

-----

###5.4完整性约束命名子句




